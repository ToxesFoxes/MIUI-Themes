<?xml version="1.0" encoding="utf-8"?>
<Lockscreen frameRate="60" frameRateBatteryLow="30" frameRateCharging="60" screenWidth="1080" version="1">
  <!-- Глобальные переменные -->

  <!-- Определение ширины и высоты экрана -->
  <Var expression="#screen_width" name="sw" type="number"/>
  <Var expression="#screen_height" name="sh" type="number"/>

  <!-- Инициализаторы -->
  <ExternalCommands>
    <Trigger action="resume">
    </Trigger>
    <Trigger action="init">
      <VariableCommand expression="0" name="current_app"/>
    </Trigger>
    <Trigger action="resume,pause">
      <VariableCommand expression="0" name="sidebar_X"/>
      <VariableCommand expression="0" name="sidebar_Y"/>
    </Trigger>
  </ExternalCommands>
  <!-- Начнём с макета -->
  <Group h="#sh" w="#sw" layered="true">
    <!-- Обои во весь экран -->
    <Wallpaper/>

    <!-- Переменные боковой панели -->
    <Var expression="156" name="panel_width" type="number"/>
    <Var expression="(#sw-#panel_width)" name="panel_x" type="number"/>
    <!-- <Wallpaper alpha="255*0.5" blur="80" pivotX="#sw" pivotY="#sh/2" y="#sh/2"/> -->

    <!-- Контент панель -->
    <Group x="0" y="#SLS_moveY" h="#sh" w="#sw-#panel_width">
      <!-- Дата и время -->
      <Group x="60" y="#sh-275">
        <DateTime size="150" x="0" y="0" color="#ffffff" format="HH:mm" fontFamily="mitype-clock"/>
        <DateTime size="65" x="0" y="150" color="#ffffff" format="EEEE, dd MMMM" fontFamily="mitype-clock"/>
      </Group>
    </Group>
    <!-- Боковая панель -->
    <Group x="#panel_x" h="#sh" w="#panel_width">
      <!-- Блюр обоев -->
      <Group h="#sh"w="#panel_width" x="0" y="0" clip="true">
        <Wallpaper x="0-#panel_x" blur="50"/>
        <!-- Затемнение -->
        <Rectangle fillColor="#000000" h="#sh" w="#panel_width" alpha="255*0.25"/>
      </Group>
      <!-- Переменные Приложений -->
      <!-- Ширина и Высота иконки -->
      <Var expression="96" name="app_w_h" type="number"/>
      <Var expression="30" name="app_margin" type="number"/>
      <!-- Переменные экранных приложений -->
      <Var name="sys_app0P" type="number" expression="0"/>
      <Var name="sys_app1P" type="number" expression="#sys_app0P - #app_w_h"/>
      <Var name="sys_app2P" type="number" expression="#sys_app1P - #app_w_h"/>
      <Var name="sys_app3P" type="number" expression="#sys_app2P - #app_w_h"/>
      <Var name="sys_app4P" type="number" expression="#sys_app3P - #app_w_h"/>
      <Var name="sys_app5P" type="number" expression="#sys_app4P - #app_w_h"/>
      <Var name="sys_app6P" type="number" expression="#sys_app5P - #app_w_h"/>
      <!-- Переменные пользовательских приложений -->
      <!-- Видимость -->
      <Var expression="strIsEmpty(@app1.package)" name="app1V" type="boolean"/>
      <Var expression="strIsEmpty(@app2.package)" name="app2V" type="boolean"/>
      <Var expression="strIsEmpty(@app3.package)" name="app3V" type="boolean"/>
      <Var expression="strIsEmpty(@app4.package)" name="app4V" type="boolean"/>
      <Var expression="strIsEmpty(@app5.package)" name="app5V" type="boolean"/>
      <Var expression="strIsEmpty(@app6.package)" name="app6V" type="boolean"/>
      <!-- Позиция -->
      <Var name="usr_apps" type="number" expression="#sys_app6P - #app_w_h"/>
      <Var name="usr_app1P" type="number" expression="ifelse(#app1V, #app_w_h + (#app_margin*1), 0)"/>
      <Var name="usr_app2P" type="number" expression="ifelse(#app2V, 0, #usr_app1P - (#app_w_h) - (#app_margin*1))"/>
      <Var name="usr_app3P" type="number" expression="ifelse(#app3V, 0, #usr_app2P - (#app_w_h) - (#app_margin*1))"/>
      <Var name="usr_app4P" type="number" expression="ifelse(#app4V, 0, #usr_app3P - (#app_w_h) - (#app_margin*1))"/>
      <Var name="usr_app5P" type="number" expression="ifelse(#app5V, 0, #usr_app4P - (#app_w_h) - (#app_margin*1))"/>
      <Var name="usr_app6P" type="number" expression="ifelse(#app6V, 0, #usr_app5P - (#app_w_h) - (#app_margin*1))"/>

      <Group x="30" y="#sh - (#app_margin * 3)">
        <Group x="#app_w_h/2">
          <!-- Windows -->
          <Group y="#sys_app0P - (#app_margin * 0)">
            <Image x="0" y="0" h="#app_w_h" w="#app_w_h" align="center" alignV="center" src="resources/apps/windows/Windows-light.png"/>
            <Button align="center" alignV="center" h="#app_w_h" w="#app_w_h" x="0" y="0">
              <Pressed>
                <Image x="0" y="0" h="#app_w_h" w="#app_w_h" alpha="255*0.5" align="center" alignV="center" src="resources/apps/windows/Windows-dark.png"/>
              </Pressed>
            </Button>
          </Group>

          <!-- User -->
          <Group y="#sys_app1P - (#app_margin * 1)">
            <Image x="0" y="0" h="#app_w_h" w="#app_w_h" align="center" alignV="center" src="resources/apps/windows/User.png"/>
          </Group>

          <!-- Settings -->
          <Group y="#sys_app2P - (#app_margin * 2)">
            <Image x="0" y="0" h="#app_w_h" w="#app_w_h" align="center" alignV="center" src="resources/apps/windows/Settings.png"/>
            <Button align="center" alignV="center" h="#app_w_h" w="#app_w_h" x="0" y="0">
              <Pressed>
                <Rectangle align="center" alignV="center" h="#app_w_h" w="#app_w_h" x="0" y="0" fillColor="#000000" alpha="255*0.5"/>
              </Pressed>
              <Triggers>
                <Trigger action="up" condition="abs(#touch_begin_y-#touch_y){50**abs(#touch_begin_x-#touch_x){50">
                  <IntentCommand action="android.intent.action.MAIN" class="miui.maml.MamlConfigSettings" package="com.android.thememanager">
                    <Extra expression="'lockstyle'" name="maml_code" type="string"/>
                  </IntentCommand>
                  <ExternCommand command="unlock"/>
                </Trigger>
              </Triggers>
            </Button>
          </Group>

          <!-- Weather -->
          <Group y="#sys_app3P - (#app_margin * 3)">
            <Image x="0" y="0" h="#app_w_h" w="#app_w_h" align="center" alignV="center" src="resources/apps/windows/Weather.png"/>
          </Group>

          <!-- Groove -->
          <Group y="#sys_app4P - (#app_margin * 4)">
            <Image x="0" y="0" h="#app_w_h" w="#app_w_h" align="center" alignV="center" src="resources/apps/windows/Groove.png"/>
          </Group>

          <!-- Calendar -->
          <Group y="#sys_app5P - (#app_margin * 5)">
            <Image x="0" y="0" h="#app_w_h" w="#app_w_h" align="center" alignV="center" src="resources/apps/windows/Calendar.png"/>
          </Group>

          <!-- Camera -->
          <Group y="#sys_app6P - (#app_margin * 6)">
            <Image x="0" y="0" h="#app_w_h" w="#app_w_h" align="center" alignV="center" src="resources/apps/windows/Camera-Icon.png"/>
          </Group>

          <!-- Пользовательские приложения -->
          <Group y="#usr_apps - (#app_margin*7)">
            <Group y="#usr_app1P">
              <Image x="0" y="0" h="#app_w_h" w="#app_w_h" srcParas="@app1.package, @app1.class" align="center" alignV="center" srcFormat="%s,%s" srcType="ApplicationIcon"/>
            </Group>
            <Group y="#usr_app2P">
              <Image x="0" y="0" h="#app_w_h" w="#app_w_h" srcParas="@app2.package, @app2.class" align="center" alignV="center" srcFormat="%s,%s" srcType="ApplicationIcon"/>
            </Group>
            <Group y="#usr_app3P">
              <Image x="0" y="0" h="#app_w_h" w="#app_w_h" srcParas="@app3.package, @app3.class" align="center" alignV="center" srcFormat="%s,%s" srcType="ApplicationIcon"/>
            </Group>
            <Group y="#usr_app4P">
              <Image x="0" y="0" h="#app_w_h" w="#app_w_h" srcParas="@app4.package, @app4.class" align="center" alignV="center" srcFormat="%s,%s" srcType="ApplicationIcon"/>
            </Group>
            <Group y="#usr_app5P">
              <Image x="0" y="0" h="#app_w_h" w="#app_w_h" srcParas="@app5.package, @app5.class" align="center" alignV="center" srcFormat="%s,%s" srcType="ApplicationIcon"/>
            </Group>
            <Group y="#usr_app6P">
              <Image x="0" y="0" h="#app_w_h" w="#app_w_h" srcParas="@app6.package, @app6.class" align="center" alignV="center" srcFormat="%s,%s" srcType="ApplicationIcon"/>
            </Group>
          </Group>
        </Group>
      </Group>
    </Group>
  </Group>
  <!-- Жест Разблокировки -->
  <!-- Максимальная высота -->
  <Var expression="300" name="unlock_maxH" type="number"/>
  <!-- Чувствительность отсчёта -->
  <Var expression="50" type="number" name="S_sensivity"/>
  <!-- Чувствительность отсчёта -->
  <Var expression="300" type="number" name="S_swipeSensivity"/>
  <!-- Динамическая частота кадров -->
  <FramerateController initPause="true" loop="false" name="Current_FPS_Anim">
    <ControlPoint frameRate="60" time="0"/>
    <ControlPoint frameRate="60" time="2000"/>
    <ControlPoint frameRate="30" time="2001"/>
  </FramerateController>
  <ExternalCommands>
    <Trigger action="init">
      <!-- Инициализация состояния разблокировщика -->
      <VariableCommand expression="1" name="unlockButtonSwitch"/>
    </Trigger>
    <Trigger action="resume,pause">
      <VariableCommand expression="0" name="S_moveX"/>
      <VariableCommand expression="0" name="S_moveY"/>
      <VariableCommand expression="0" name="S_posH"/>
      <VariableCommand expression="0" name="S_posV"/>
      <VariableCommand expression="0" name="S_isMoveX"/>
      <VariableCommand expression="0" name="S_isMoveY"/>
      <VariableCommand expression="0" name="S_latestX"/>
      <VariableCommand expression="0" name="S_latestY"/>
      <VariableCommand expression="0" name="S_directionX"/>
      <VariableCommand expression="0" name="S_directionY"/>
    </Trigger>
  </ExternalCommands>
  <!-- <Group>
    <Text color="#ffffff" textExp="#SLS_moveX" size="50" x="150" y="150"/>
    <Text color="#ffffff" textExp="#SLS_moveY" size="50" x="150" y="200"/>
    <Text color="#ffffff" textExp="#SLS_moveA" size="50" x="150" y="250"/>
    <Text color="#ffffff" textExp="#SLS_moveB" size="50" x="150" y="300"/>
    <Text color="#ffffff" textExp="#SLS_moveAn" size="50" x="150" y="350"/>
    <Text color="#ffffff" textExp="#SLS_unlockA" size="50" x="150" y="400"/>
    <Text color="#ffffff" textExp="#SLS_unlockAn" size="50" x="150" y="450"/>
    <Text color="#ffffff" textExp="#SLS_moveX_SW" size="50" x="150" y="500"/>
    <Text color="#ffffff" textExp="#SLS_moveY_SW" size="50" x="150" y="550"/>
  </Group> -->
  <Group x="50">
    <Text color="#ffffff" textExp="#S_moveX + ' - S_moveX'" size="50" y="150"/>
    <Text color="#ffffff" textExp="#S_moveY + ' - S_moveY'" size="50" y="200"/>
    <Text color="#ffffff" textExp="#S_posH + ' - S_posH'" size="50" y="250"/>
    <Text color="#ffffff" textExp="#S_posV + ' - S_posV'" size="50" y="300"/>
    <Text color="#ffffff" textExp="#S_isMoveX + ' - S_isMoveX'" size="50" y="350"/>
    <Text color="#ffffff" textExp="#S_isMoveY + ' - S_isMoveY'" size="50" y="400"/>
    <Text color="#ffffff" textExp="#S_latestX + ' - S_latestX'" size="50" y="450"/>
    <Text color="#ffffff" textExp="#S_latestY + ' - S_latestY'" size="50" y="500"/>
    <Text color="#ffffff" textExp="#S_directionX + ' - S_directionX'" size="50" y="550"/>
    <Text color="#ffffff" textExp="#S_directionY + ' - S_directionY'" size="50" y="600"/>
    <Text color="#ffffff" textExp="#S_sensivity + ' - S_sensivity'" size="50" y="650"/>
    <Text color="#ffffff" textExp="#S_swipeSensivity + ' - S_swipeSensivity'" size="50" y="700"/>
    <Text color="#ffffff" textExp="#nameholder_offsetX + ' - nameholder_offsetX'" size="50" y="750"/>
    <Text color="#ffffff" textExp="#t_bx + ' - t_bx'" size="50" y="800"/>
    <Text color="#ffffff" textExp="#t_by + ' - t_by'" size="50" y="850"/>
  </Group>
  <Button x="0" y="0" h="#sh" w="#panel_x">
    <Triggers>
      <!-- Нажатие : касание -->
      <Trigger action="down">
        <AnimationCommand command="play" target="Current_FPS_Anim"/>
        <MultiCommand>
          <VariableCommand expression="#touch_x" name="t_x"/>
          <VariableCommand expression="#touch_begin_x" name="t_bx"/>
          <VariableCommand expression="#touch_y" name="t_y"/>
          <VariableCommand expression="#touch_begin_y" name="t_by"/>
        </MultiCommand>
      </Trigger>
      <!-- Нажатие : движение -->
      <Trigger action="move">
        <AnimationCommand command="play" condition="#frame_rate { 55" target="Current_FPS_Anim"/>
        <MultiCommand condition="#SLS_moveX_SW == 0 ** #SLS_moveY_SW == 0">
          <VariableCommand condition="(#SLS_moveX_SW == 0) ** ((#touch_y-#touch_begin_y) { -50)" expression="1" name="SLS_moveY_SW"/>
          <VariableCommand condition="(#SLS_moveY_SW == 0) ** (abs(#touch_y-#touch_begin_y) } 50)" expression="1" name="SLS_moveX_SW"/>
          <VariableCommand condition="#SLS_moveX_SW" expression="((#touch_x } #touch_begin_x)*2-1)*50" name="nameholder_offsetX"/>
        </MultiCommand>
        <MultiCommand>
          <VariableCommand expression="int(#touch_x-#touch_begin_x)" name="t_bx"/>
          <VariableCommand expression="int(#touch_y-#touch_begin_y)" name="t_by"/>

          <VariableCommand expression="ifelse((#t_bx { 0 - #S_sensivity) || (#t_bx } #S_sensivity), #t_bx, 0)" name="S_moveX"/>
          <VariableCommand expression="ifelse((#t_by { 0 - #S_sensivity) || (#t_by } #S_sensivity), #t_by, 0)" name="S_moveY"/>

          <VariableCommand condition="#S_moveX { (0 - #S_sensivity)" expression="1" name="S_directionX"/>
          <VariableCommand condition="eq(#S_moveX, 0)" expression="0" name="S_directionX"/>
          <VariableCommand condition="#S_moveX } #S_sensivity" expression="-1" name="S_directionX"/>

          <VariableCommand condition="#S_moveY { (0 - #S_sensivity)" expression="1" name="S_directionY"/>
          <VariableCommand condition="eq(#S_moveY, 0)" expression="0" name="S_directionY"/>
          <VariableCommand condition="#S_moveY } #S_sensivity" expression="-1" name="S_directionY"/>
        </MultiCommand>

        <VariableCommand condition="#SLS_moveY_SW" expression="min(0,int(#touch_y-#touch_begin_y+50))" name="SLS_moveY"/>
        <MultiCommand condition="#SLS_moveX_SW">
          <VariableCommand expression="(#touch_begin_y { (#screen_height-(100)*2)+200) ** (int(#SLS_moveAn+#touch_x-(#touch_begin_x+#nameholder_offsetX)) { 0)" name="SLS_leftMoveSW"/>
          <VariableCommand expression="max(-50,#SLS_leftMoveSW*int(#touch_x-#touch_begin_x+50))" name="nameholder_springingA"/>
          <VariableCommand expression="int(#touch_x-(#touch_begin_x+#nameholder_offsetX))" name="SLS_moveX"/>
          <VariableCommand condition="#SLS_leftMoveSW" expression="max(#SLS_moveX,0)" name="SLS_moveX"/>
        </MultiCommand>
      </Trigger>
      <!-- Нажатие : отпускание/отмена -->
      <Trigger action="up,cancel">
        <AnimationCommand command="play" target="Current_FPS_Anim"/>

        <MultiCommand>
          <VariableCommand expression="0" name="S_directionX"/>
          <VariableCommand expression="0" name="S_directionY"/>

          <VariableCommand expression="0" name="S_moveX"/>
          <VariableCommand expression="0" name="S_moveY"/>
        </MultiCommand>






        <!-- Вертикальная разблокировка -->
        <MultiCommand condition="#SLS_moveY_SW">
          <!-- Условие для высоты разблокировки -->
          <ExternCommand command="unlock" condition="#SLS_moveY {= -#unlock_maxH"/>
          <VariableCommand expression="#SLS_moveY {= -#unlock_maxH" name="SLS_unlockSW"/>
          <!-- Запустить экран разблокировки -->
          <MultiCommand condition="#SLS_moveY } -#unlock_maxH">
            <VariableCommand expression="#SLS_moveY" name="SLS_unlockA"/>
            <VariableCommand expression="0" name="SLS_moveY"/>
            <AnimationCommand command="play" target="SLS_unlockAn"/>
          </MultiCommand>
        </MultiCommand>

        <MultiCommand condition="#SLS_moveX_SW">
          <VariableCommand expression="((#touch_x } #touch_begin_x)*2-1)*(abs(#SLS_moveX) } 200)*(#defaultScreen_x { 1080)*(#defaultScreen_x } -1080)" name="SLS_direction"/>
          <MultiCommand condition="#SLS_moveX != 0">
            <VariableCommand expression="#defaultScreen_x" name="SLS_moveA"/>
            <VariableCommand expression="#SLS_moveB+#SLS_direction*1080" name="SLS_moveB"/>
            <VariableCommand expression="0" name="SLS_moveX"/>
            <AnimationCommand command="play" target="SLS_moveAn"/>
          </MultiCommand>
          <MultiCommand condition="#SLS_direction == 0 ** #touch_x { #touch_begin_x">
            <AnimationCommand command="play(1200,0)" target="SLS_hintAn"/>
            <AnimationCommand command="play" target="SLS_springingAn"/>
            <VariableCommand expression="0" name="nameholder_springingA"/>
          </MultiCommand>
        </MultiCommand>
        <VariableCommand expression="0" name="nameholder_offsetX"/>
        <VariableCommand condition="!#SLS_unlockSW" expression="0" name="SLS_moveY_SW"/>
        <VariableCommand expression="0" name="SLS_moveX_SW"/>
      </Trigger>
    </Triggers>
  </Button>
  <!-- Глобальные анимации -->
  <Var name="AnimUnlock">
    <VariableAnimation initPause="true" loop="false">
      <Item easeType="SineEaseOut" time="0" value="#SLS_unlockA"/>
      <Item time="200" value="0"/>
    </VariableAnimation>
  </Var>
  <Var name="AnimHint">
    <VariableAnimation initPause="true" loop="false">
      <Item time="0" value="0"/>
      <Item time="300" value="178"/>
      <Item time="1200" value="178"/>
    </VariableAnimation>
  </Var>
  <Var name="AnimSpringing">
    <VariableAnimation initPause="true" loop="false">
      <Item easeType="BounceEaseOut" time="0" value="#nameholder_springingA"/>
      <Item time="600" value="0"/>
    </VariableAnimation>
  </Var>
</Lockscreen>